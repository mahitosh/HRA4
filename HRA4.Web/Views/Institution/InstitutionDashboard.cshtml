@model IEnumerable<HRA4.ViewModels.Appointment>

@{
    ViewBag.Title = "InstitutionDashboard";

}

@if (ViewBag.instListcount == 0 || ViewBag.instListcount == null)
{
    <div class="modal fade" tabindex="-1" role="dialog" id="dashboardmodal" data-keyboard="false" data-backdrop="static">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body">
                    <p>You have not entered any institution data. Please start by<a href="@Url.Action("ManageInstitution", "Admin")"> entering an institution name.</a></p>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
}
else
{


    <div class="content-area container-fluid ">
        <div class="container-fluid row Padding-LR-0 bottom-container-area">
            <div class="container middle-content">
                <div class="row">
                    <div class="col-sm-12">
                        <div id="wrapper">
                            <!-- Sidebar -->
                            <div id="sidebar-wrapper">

                                <ul class="sidebar-nav nav-pills nav-stacked" id="menu">
                                    <li class="active">
                                        <a href="#" class="schedule-icon"> Schedule <span id="ScheduleCount" class="dashboard-count">@ViewBag.AppointmentCount</span></a>
                                        <ul class="nav-pills nav-stacked sidebar-nav-child" style="list-style-type:none;">
                                            <li class="add-appointment"><a href="#"><img src="~/images/add-appointment-ico.svg" alt="Refresh" width="25" height="25" /> Add Appointment</a></li>
                                            <li>
                                                <div class="form-group">
                                                    <label class="control-label " for="custom-clinic"> Choose Clinic</label>
                                                    @Html.DropDownList("ddClinic", ViewBag.ClinicList as SelectList, "All Clinics", new { @class = "form-control" })
                                                </div>
                                            </li>

                                            <li>
                                                <div class="form-group">
                                                    <label class="control-label " for="name">Quick Search</label>
                                                    <input class="form-control" id="name" name="name" type="text" placeholder="Name/MRN" />
                                                </div>
                                            </li>
                                            <li>
                                                <div class="pull-left"><input type="checkbox" id="chkbox" checked="checked" name="appt-date-checkbox" class="" /></div>
                                                <div id="app-date" class="inner-addon right-addon pull-right form-group">
                                                    <span class="glyphicon glyphicon-calendar" aria-hidden="true"></span>
                                                    <input data-format="MM-dd-yyyy" type="text" class="datepicker form-control" id="appt-date" placeholder="Appointment Date" value="@ViewBag.TodaysDate" />
                                                </div>
                                            </li>
                                            <li class="pull-right">
                                                <div class="btn-group search-group Margin-B-10">
                                                    <button class="btn btn-default search-btn" id="btnsearch" type="button">Search</button>
                                                    <span class="glyphicon glyphicon-search search-btn-ico" aria-hidden="true"></span>
                                                </div> <br />
                                            </li>
                                        </ul><!--sidebar child end here-->
                                    </li>
                                    <li class="clear-float">
                                        <a href="#" class="breast-cancer-icon">Breast</a>
                                    </li>
                                    <li>
                                        <a href="#" class="lifetime-cancer-icon">Lifetime Breast Cancer <span class="dashboard-count">(3)</span></a>
                                    </li>
                                    <li>
                                        <a href="#" class="BRCA-icon">BRCA Mutation <span class="dashboard-count">(5)</span></a>
                                    </li>
                                </ul>

                            </div><!-- /#sidebar-wrapper -->
                            <div class="collapse navbar-collapse pull-left" id="bs-example-navbar-collapse-1">
                                <button class="navbar-toggle collapse in" data-toggle="collapse" id="menu-toggle-2"><i class="fa fa-chevron-circle-right fa-lg"></i></button>
                            </div><!--  sidebar toggle div end -->
                            <!-- Page Content -->

                            <div id="page-content-wrapper" class="clear-float">
                                <div class="container-fluid xyz clear-float">
                                    <div class="row">
                                        <h3 class="pull-left page-title">Schedule</h3>
                                        <a class="pull-right left-title" onclick="SearchAppointment()"><img src="~/images/refresh-grid-ico.svg" class="refresh-istitution-list" alt="Refresh" width="22" height="22" />Refresh Institution list</a>
                                        <div class="clear-float"></div>
                                        <div class="table-responsive" id="divInstitutionGrid">
                                            @Html.Partial("_InstitutionGrid", Model)

                                        </div><!--schedule list div end here-->
                                        <div id="divRecordStatus" style="color:red;text-align:center">@ViewBag.RecordStatus</div>
                                    </div><!--row end-->
                                </div><!--container end-->

                            </div>
                            <!-- /#page-content-wrapper -->
                        </div>
                    </div>
                </div><!--row end-->
            </div><!--container end-->
        </div><!--container fluid end-->
    </div> <!-- /container area end -->
}

<style>
    #progressbar .ui-progressbar-value {
        background-color: #ccc;
    }
</style>
<script type="text/javascript">
    function spin() {
        var opts = {
            lines: 12, // The number of lines to draw
            length: 7, // The length of each line
            width: 4, // The line thickness
            radius: 10, // The radius of the inner circle
            color: '#000', // #rgb or #rrggbb
            speed: 1, // Rounds per second
            trail: 60, // Afterglow percentage
            shadow: false, // Whether to render a shadow
            hwaccel: false // Whether to use hardware acceleration
        };
        var target = document.getElementById('msgbody');
        var spinner = new Spinner(opts).spin(target);

    };
    function RunDocs(MRN, apptid) {
        $('.modal-backdrop').remove();
        var globalGetJSONPath = '@Url.Action("RunAutomationDocuments", "Institution")';
        $.ajax({
            beforeSend: function () {
                $("#line").hide();
                $("#loading").hide();
                $(".modal-footer").hide();
                $('#Downloadbtn').prop('disabled', true);
                $('#CloseBtn').prop('disabled', true);
                $("#msgbody").html('<div id="progressbar"></div>');
                $("#progressbar").progressbar({
                    value: false
                });

            },
            type: "POST",
            url: globalGetJSONPath,
            data: { apptid: apptid, MRN: MRN },
            dataType: "json",
            async: true,
            success: function (data) {
                $(".modal-footer").show();
                $("#msgbody").html('<br><div id="line">Run Automation Documents Process Finished Click on download</div></br>');
                $('#Downloadbtn').prop('disabled', false);
                $('#CloseBtn').prop('disabled', false);
            }
        }).always(function (Data) {

        });
    };

    function hide() {
        $('#browse-xml').hide();
        $('.modal-backdrop').remove();

    };
    function saveClinic() {
        var id = $("#ddClinic").val();
        console.log(id);
        $("#Hfddlclinic").val(id);
    };
    $(document).ready(function () {

        $("#frmDashboard").keypress(function (e) {
            kCode = e.keyCode || e.charCode //for cross browser
            if (kCode == 13) {
                var defaultbtn = $(this).attr("DefaultButton");
                $("#" + defaultbtn).click();
                return false;
            }
        });


        

        $('#Downloadbtn').click(function () {
            var globalGetJSONPath = '@Url.Action("DownloadFile", "Institution")';
            $.ajax({
                type: "GET",
                url: globalGetJSONPath,
                success: function (data) {

                }
            }).always(function (Data) {
                $("#loading").hide();
            });

        });

        $('#chkbox').change(function () {
             if ($(this).is(":checked")) {
                /*
                var today = new Date();
                var dd = today.getDate();
                var mm = today.getMonth() + 1; //January is 0!
                var yyyy = today.getFullYear();
                if (dd < 10) {
                    dd = '0' + dd
                }
                if (mm < 10) {
                    mm = '0' + mm
                }
                var today = mm + '/' + dd + '/' + yyyy;
                $("#appt-date").val(today);
                */
                $("#appt-date").prop('readonly', false);
                $('#appt-date').prop('disabled', false);


            } else {
                $("#appt-date").prop('readonly', true);
                $('#appt-date').prop('disabled', true);
                // $("#appt-date").val('');

            }
             SearchAppointment();
           
        });

        $("#btnsearch").click(function (data) {
            SearchAppointment();
           
        });

        $("#ddClinic").change(function (data) {
            SearchAppointment();
        });


    });


    function SearchAppointment() {
        
        var name = $('#name').val();
        var appdt = $('#chkbox').is(":checked") ? $('#appt-date').val() : "";
        var clinicId = $('#ddClinic').val().length > 0 ? $('#ddClinic').val() : "-1";

        var globalGetJSONPath = '@Url.Action("FilteredInstitution", "Institution")';

        $.ajax({
            type: "POST",
            url: globalGetJSONPath,
            data: { name: name, appdt: appdt, clinicId: clinicId },
            dataType: "json",
            async: true,
            success: function (Data) {
                $('#divRecordStatus').html('');
                $('#ScheduleCount').html(Data.apps_count);
                $('#divInstitutionGrid').html(Data.view);
               
                //if ($('#chkbox').is(":checked"))
                //{
                //    alert("Hi");
                //    $("#appt-date").val(Data.todaysDate);
                //}

                if (parseInt(Data.apps_count, 0) == 0) {
                    $('#divRecordStatus').html("No records found.");
                }


            }

        })

    }



    function AddRemoveTask(isDNC, unitnum, apptid) {

        var name = $('#name').val();
        var appdt = $('#appt-date').val();
        var clinicId = $('#ddClinic').val().length > 0 ? $('#ddClinic').val() : "-1";

        var globalGetJSONPath = '@Url.Action("AddRemoveTask", "Institution")';

        $.ajax({
            type: "POST",
            url: globalGetJSONPath,
            data: { name: name, appdt: appdt, isDNC: isDNC, unitnum: unitnum, apptid: apptid, clinicId: clinicId },
            dataType: "json",
            async: true,
            success: function (Data) {
                $('#divRecordStatus').html('');
                $('#ScheduleCount').html(Data.apps_count);
                $('#divInstitutionGrid').html(Data.view);
                if (parseInt(Data.apps_count, 0) == 0) {
                    $('#divRecordStatus').html("No records found.");
                }
            }
        })
    };





</script>
